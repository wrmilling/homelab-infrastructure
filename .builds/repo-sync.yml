image: alpine/edge
secrets:
- f3b41d81-0cf6-4380-a4f2-4199cee27354
sources:
- https://git.sr.ht/~wrmilling/homelab-infrastructure
tasks:
- push: |
    # Set Repo Name
    REPO=homelab-infrastructure

    # Ensure we are on the main branch, exit build if not
    cd $REPO
    git diff -s --exit-code origin/master || complete-build

    # Ignore hosts keys, since we accept them as-is
    git config --global core.sshCommand 'ssh -o UserKnownHostsFile=/dev/null -o StrictHostKeyChecking=no'

    # Push copy of code to GitHub
    git remote add github git@github.com:wrmilling/${REPO}.git
    git push github master

    # Push copy of code to Codeberg
    git remote add codeberg git@codeberg.org:wrmilling/${REPO}.git
    git push codeberg master

    # Push copy of code to GitLab
    git remote add gitlab git@gitlab.com:WRMilling/${REPO}.git
    git push gitlab master
 
